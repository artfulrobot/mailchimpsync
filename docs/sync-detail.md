


### Sync process types

1. A frequently run incremental sync. This process checks for changes made
   since the last sync, and processes them.

2. Immediate sync for a single contact. When a record is changed on Mailchimp,
   it should fire a webhook to tell CiviCRM about the changes. CiviCRM can then
   immediately sync that contact. Mailchimp does not fire these webhooks for
   every type of update, so this alone is not enough.

3. Data sync. (todo) Updates any data generated by CiviCRM that is to be stored
   in Mailchimp also.


The main incremental sync process is supposed to be run frequently and
regularly. How often is up to you, could be every 5 minutes or every hour.
There are parts to this:

1. **Fetch and reconcile**: When a sync is started a process fetches
   information from Mailchimp and CiviCRM and updates a local subscribers cache
   table. Next begins a reconciliation algorithm which compares it and decides
   which service should be considered correct. Updates to CiviCRM are made
   directly. Updates to Mailchimp are submitted to Mailchimp in batches of up
   to 1,000 per batch and we then have to wait for them to finish processing
   these.

2. **Batch result handler**: A Mailchimp Batch Update Webhook causes the result
   of a batch to be fetched (from Mailchimp) and inspected. Unsusccessful
   updates that were due to us trying to subscribe someone who previously
   unsubscribed result in a new update job to set their status to
   'pending'. Other failures are just logged.




[![Flowchart diagram](./sync.svg)](./sync.svg)
